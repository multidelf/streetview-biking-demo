
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>一騎出發吧｜街景騎乘模擬器</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; font-family: sans-serif; }
    #logoHeader {
      position: absolute; top: 10px; left: 10px; z-index: 999;
      background: rgba(255,255,255,0.85); border-radius: 8px;
      padding: 5px 10px; display: flex; align-items: center; font-weight: bold;
    }
    #logoHeader img { height: 32px; margin-right: 8px; }
    #routePanel {
      position: absolute; top: 60px; left: 10px; z-index: 998;
      background: rgba(255,255,255,0.95); padding: 12px; width: 360px;
      border-left: 5px solid #4CAF50; border-radius: 5px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2); font-size: 14px;
    }
    select, button {
      font-size: 14px; margin-top: 6px; padding: 6px;
      border-radius: 4px; border: 1px solid #ccc; width: 100%;
    }
    #stationList { margin-top: 10px; max-height: 160px; overflow-y: auto; border-top: 1px solid #ddd; padding-top: 6px; }
    .stationItem { cursor: pointer; padding: 4px; margin-bottom: 2px; border-radius: 3px; }
    .stationItem:hover { background: #eef; }
    #map { width: 100%; height: 240px; margin-top: 10px; border-radius: 4px; }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB3MsVlR7h6MsYf1Xjw02BPwB3r95wXsYk"></script>
</head>
<body>
  <div id="logoHeader">
    <img src="assets/img/logo.jpg" alt="Logo">
    一騎出發吧｜街景騎乘模擬器
  </div>

  <div id="routePanel">
    <label for="routeSelect">🔽 選擇路線</label>
    <select id="routeSelect"><option>載入中...</option></select>
    <div id="stationList"></div>
    <div id="map"></div>
  </div>

  <script>
    const apiBase = "https://script.google.com/macros/s/AKfycbzctNoMZS3m3FX3q1s3Ka4ZgK-bVsMKkOh0rL9IQaS1wO1dprzkUcCpZqE4YpQW7vtA/exec";
    const routeSelect = document.getElementById("routeSelect");
    const stationList = document.getElementById("stationList");
    let map, marker;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 14,
        center: { lat: 24.15, lng: 120.68 }
      });
    }

    async function fetchRouteNames() {
      const res = await fetch(apiBase);
      const data = await res.json();
      routeSelect.innerHTML = data.routes.map(name => `<option value="${name}">${name}</option>`).join("");
    }

    async function fetchRouteByName(name) {
      const res = await fetch(`${apiBase}?routeName=${encodeURIComponent(name)}`);
      const data = await res.json();
      renderStations(data.points);
    }

    function renderStations(points) {
      stationList.innerHTML = points.map(pt => `
        <div class="stationItem" onclick="moveTo(${pt.lat}, ${pt.lng})">
          🟢 [${pt.order}] ${pt.name}｜${pt.lat.toFixed(5)}, ${pt.lng.toFixed(5)}
        </div>
      `).join("");
      if (points[0]) moveTo(points[0].lat, points[0].lng);
    }

    function moveTo(lat, lng) {
      const pos = { lat, lng };
      map.setCenter(pos);
      if (!marker) {
        marker = new google.maps.Marker({ position: pos, map });
      } else {
        marker.setPosition(pos);
      }
    }

    routeSelect.addEventListener("change", () => {
      fetchRouteByName(routeSelect.value);
    });

    window.onload = () => {
      initMap();
      fetchRouteNames();
    };
  </script>
</body>
</html>
